<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
    ﻿html,body,div,form,fieldset,legend,label,h1{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0}th,td{text-align:left;vertical-align:top}h1,h2,h3,h4,h5,h6,th,td,caption{font-weight:normal}img{border:0;max-width:100%}video{max-width:100%}h1{font-size:1.87em}h2{font-size:1.2em;margin-bottom:10px;margin-top:0px}h3{margin-top:50px}body{background-color:#fff;color:rgba(0,0,0,0.8);font-family:medium-content-serif-font,Georgia,Cambria,"Times New Roman",Times,serif;-moz-font-feature-settings:"liga" on;font-feature-settings:"liga" on;font-size:1.25em;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;letter-spacing:-.003em;line-height:1.58;text-rendering:optimizeLegibility}article{margin-top:44px}pre{-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:.92em;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;padding:20px;overflow:auto}::-moz-selection{background:#000;color:#fff}::selection{background:#000;color:#fff}body{margin-top:8%}header{font-size:.78em;margin:0 auto 2em;max-width:220px;text-align:center}a:link,a:visited,a:hover,a:active{color:#AF403C;text-decoration:none}a:hover{text-decoration:underline}nav{text-align:center}nav ul{display:inline-block;text-align:initial;padding-left:0px}nav li:not(:first-child):before{content:" · "}nav li{list-style:none;display:inline}.logo{background-size:cover;display:inline-block;height:150px;width:171px}hr{background-color:#333;border:0;height:1px;margin:30px 0}.published-date{color:#888;font-size:.8em}.subtitle{margin:0 0 2em}blockquote{border-left:4px solid #ededee;font-style:italic;margin:4px 10px;padding:3px 20px}code{background-color:#f9f9fa;border:1px solid #ededee;border-radius:6px;display:inline-block;font-family:"Courier New", "Courier", monospace;-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:16px;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;max-width:100%;overflow-x:auto;padding:0 5px;vertical-align:middle;word-wrap:normal;box-shadow:0 1px 1px rgba(0,0,0,0.125)}.button{background-color:#AF403C;border-radius:10px;color:#fff;margin:40px auto;padding:10px;text-align:center}.button:hover{background-color:red}.talk{margin-top:80px}figure{font-size:.9em;font-style:italic;margin:0 0 40px;padding:0;text-align:center;text-indent:0}figcaption{margin-top:10px}.loader{position:relative;overflow:hidden;width:auto}.loader object{position:absolute}.loader img,.loader object{display:block;top:0;left:0;width:100%}object{position:relative;float:left;display:block}object::after{position:absolute;top:0;left:0;display:block;width:1000px;height:1000px;content:'';background:#efefef}.frozen{-webkit-filter:blur(8px);-moz-filter:blur(8px);-o-filter:blur(8px);-ms-filter:blur(8px);filter:blur(8px);transform:scale(1.04);animation:0.2s ease-in 0.4s 1 forwards fade;width:100%}@keyframes fade{0%{opacity:1}100%{opacity:0}}@media (max-width: 520px){body{padding:0 20px}pre{font-size:.85em;padding:5px}h1{font-size:1.6em}}@media (min-width: 520px){body{margin:10% auto 0;width:480px}h1{font-size:1.6em}}@media (min-width: 1024px){body{width:850px}header{float:left;width:210px}main,footer{margin-left:260px;margin-bottom:40px}}.post-navigation{margin-bottom:10px}footer{border-top:1px solid black;margin-bottom:40px}footer .links{list-style:none;display:inline}

    </style>
    <link rel="dns-prefetch" href="//www.google-analytics.com/" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=m2llJQPQq8">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=m2llJQPQq8">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=m2llJQPQq8">
    <link rel="manifest" href="/manifest.json?v=m2llJQPQq8">
    <link rel="mask-icon" href="/safari-pinned-tab.svg?v=m2llJQPQq8" color="#5bbad5">
    <link rel="shortcut icon" href="/favicon.ico?v=m2llJQPQq8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">


<meta property="og:title" content="Of Boxes and Trees - Smart Pointers in Rust" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Recently, I tried to implement a binary tree..." />
<meta property="og:url" content="https://matthias-endler.de/2017/boxes-and-trees" />
<meta property="og:image" content="https://matthias-endler.de/img/social/default.png" />

<meta name="twitter:title" content="Of Boxes and Trees - Smart Pointers in Rust">
<meta name="twitter:description" content="Recently, I tried to implement a binary tree...">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@matthiasendler">
<meta name="twitter:creator" content="@matthiasendler">
<meta name="twitter:image" content="https://matthias-endler.de/img/social/default.png">

    
    <title>Of Boxes and Trees - Smart Pointers in Rust | Matthias Endler</title>

    <meta name="author" content="Matthias Endler">
    <meta name="description" content="Personal website of Matthias Endler, a Software Engineer interested in low-level programming and backend development. PHP, Python, Go, Rust."/><script type="text/javascript">
if (location.hostname !== "localhost" && location.hostname !== "127.0.0.1") {
    (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
    0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
    for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);

    mixpanel.init("b90a3ae15c47924a498cf617c96cee0c");
}
</script>

  </head>
  <body>
        <header>
            <a class="logo" href="/"><img alt="Home" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3OTAuMDUgNzc4Ljk1Ij48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjQuNzIyIC0yNDYuNzQ2KSI+PHBhdGggc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSU7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonRXZlciBBZnRlciwgTm9ybWFsJzt0ZXh0LWFsaWduOnN0YXJ0IiBkPSJNNTUzLjEzIDg4Ny40djEzOC4zaDExLjM2Vjg4Ny40em0zOS43NiAwdjUxLjg2bC0uMS0uMTd2MjAuN2wuMS4xdjY1LjdoMTEuMlY4ODcuNHoiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PGNpcmNsZSByPSIyMTkuNjgiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiBjeD0iNDM3Ljg4IiBjeT0iNTYwLjc5IiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjE2LjAzIi8+PGcgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlPSIjYTE2MjAwIj48cGF0aCBkPSJNNTA4LjM4IDU5OC44MmwtNjcuMDcgNDAuMTUtNzQuMi0zOS41M3oiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiBmaWxsPSIjMzMxZjAwIiBzdHJva2Utd2lkdGg9IjEuOTciLz48cGF0aCBkPSJNNTExLjI4IDU5OWwtNzAuMiAzNC4wMy03Ni45LTMzLjl6IiBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JSIgZmlsbD0iI2VmYmEwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9nPjxnIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxOTMuMjcgMzM2KSBzY2FsZSguNjU3OTUpIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCI+PGVsbGlwc2Ugcnk9IjI4IiByeD0iMjUuMjUiIGN5PSItMTYzLjE0IiBjeD0iLTYwOC43NSIgdHJhbnNmb3JtPSJtYXRyaXgoMS4yNDg5NyAtLjExMzcgLjEwNyAxLjE3NTE3IDEwOTUuODcgNDY2LjcpIi8+PGVsbGlwc2Ugcnk9IjE3LjA0IiByeD0iMTUuMTUiIGN5PSIzNDcuOTkiIGN4PSIzMzEuMzYiIHRyYW5zZm9ybT0ibWF0cml4KC41MjIxMyAwIDAgLjU0NzQ1IDE1OC43NTcgMTM2LjQzMikiIGZpbGw9IiNmZmYiLz48L2c+PGcgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE5My4yNyAzMzYpIHNjYWxlKC42NTc5NSkiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIj48ZWxsaXBzZSByeT0iMjgiIHJ4PSIyNS4yNSIgY3k9Ii0xNjMuMTQiIGN4PSItNjA4Ljc1IiB0cmFuc2Zvcm09Im1hdHJpeCgxLjI0ODk3IC0uMTEzNyAuMTA3IDEuMTc1MTcgMTIwMy4yIDQ2Ny42NDYpIi8+PGVsbGlwc2Ugcnk9IjE3LjA0IiByeD0iMTUuMTUiIGN5PSIzNDcuOTkiIGN4PSIzMzEuMzYiIHRyYW5zZm9ybT0ibWF0cml4KC41MjIxMyAwIDAgLjU0NzQ1IDI2NS4zNTggMTM2Ljk5MykiIGZpbGw9IiNmZmYiLz48L2c+PHBhdGggc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSUiIGQ9Ik00MzMuODcgNDIwLjE0Yy04MS44NS4yNy0xNTYuNDQgMTA0LjQzLTE4MC40OCAyMTYuNDVhMTk5LjYgMTk5LjYgMCAwIDAgNTEuOCA3M2M3LjktMTU3LjkgNDQuOC0yNjcgMTEyLjYtMjA3LjkgMTAuMSA4LjggMTUuMSAxMi45IDIwIDEyLjYgNC45LjMgMTAtMy44IDIwLjEtMTIuNyA2Ny43LTU5LjEgMTA0LjYgNDkuOSAxMTIuNSAyMDcuOGExOTkuNiAxOTkuNiAwIDAgMCA1MS44LTcyLjljLTI0LTExMi05OC42LTIxNi4yLTE4MC41LTIxNi41LTEuNCAwLTIuNyAwLTQgLjEtMS40LS4xLTIuNy0uMS00LS4xeiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiLz48cGF0aCBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JTstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOidFdmVyIEFmdGVyLCBOb3JtYWwnO3RleHQtYWxpZ246c3RhcnQiIGQ9Ik0xNTUuOTIgMTAyNS43aDExLjRsLTIwLjktMTM4LjNoLTEyLjI4bC0yMC45IDEzOC4zaDExLjRsNS44Ny00NS44MmgxOS40em0tMjQuMi01NC45OGw4LjQ3LTY0LjMgOC40IDY0LjN6bTgyLjA2LTgzLjMyaC00MS4xNHYxMC43MmgxNC44NnYxMjcuNTdoMTEuNFY4OTguMWgxNC44OHoiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIiBmaWxsPSIjOTU5NTk1Ii8+PHBhdGggc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSU7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonRXZlciBBZnRlciwgTm9ybWFsJzt0ZXh0LWFsaWduOnN0YXJ0IiBkPSJNMjUzLjI4IDg4Ny40aC00MS4xNHYxMC43MkgyMjd2MTI3LjU3aDExLjQyVjg5OC4xaDE0Ljg2em00NC45IDB2NjEuMzdIMjY5LjhWODg3LjRoLTExLjR2MTM4LjNoMTEuNHYtNjYuNGgyOC4zNXY2Ni40aDExLjIzVjg4Ny40ek0zMzYgMTAyNS43aC0xMS40MlY4ODcuNGgxMS40em01Ny42MiAwaDExLjRsLTIwLjktMTM4LjNoLTEyLjI4bC0yMC45MiAxMzguM2gxMS40bDUuOS00NS44MmgxOS4zNXptLTI0LjItNTQuOThsOC40Ny02NC4zIDguNCA2NC4zeiIgZm9udC1mYW1pbHk9IkV2ZXIgQWZ0ZXIiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiIGZpbGw9IiM5NTk1OTUiLz48cGF0aCBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JTstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOidFdmVyIEFmdGVyLCBOb3JtYWwnO3RleHQtYWxpZ246c3RhcnQiIGQ9Ik01NDEuOSA4OTguMTJWODg3LjRoLTMxLjY0djEzOC4zaDMxLjYzdi0xMC43MmgtMjAuM1Y5NTkuM2gxOC44di0xMC41M2gtMTguOHYtNTAuNjV6bTkxLjI0LTEwLjcySDYxOS4zdjEzOC4zaDEzLjg0cTIyLjMgMCAyOS41Ni0yMi40OCA0LjE1LTEzLjMgNC4xNS00Ni42NyAwLTMzLjM3LTQuMTUtNDYuNjgtNy4yNi0yMi40Ny0yOS41Ni0yMi40N3ptLTEuMiAxMjcuNThoLTEuMjJWODk4LjEyaDEuMnExNS43NCAwIDIwLjU4IDE4LjUgMy4xIDExLjA2IDMuMSAzOS45MyAwIDI4Ljg3LTMuMSAzOS45My00Ljg0IDE4LjUtMjAuNTcgMTguNXptNjAuMjMgMFY4ODcuNGgtMTEuNHYxMzguM2gzMS42MnYtMTAuNzJ6bTYyLjEtMTE2Ljg2Vjg4Ny40aC0zMS42NHYxMzguM2gzMS42M3YtMTAuNzJoLTIwLjIyVjk1OS4zaDE4Ljg0di0xMC41M2gtMTguODR2LTUwLjY1em02MC41IDEyNy41OHEtMTQuMTctMzctMjAuNzQtNzIuMjcgMTQuMTctMTAuMzcgMTQuMTctMzMuODggMC0zMi4xNS0yNy40OC0zMi4xNWgtMTUuMnYxMzguM2gxMS40di02NXEyLjI0LS41MiA2LjktMi4wOCA3LjEgMzMuMzYgMTguMzMgNjcuMDd6bS0zNy44Ni03OC41di00OS4wOGgyLjZxMTAuNiAwIDE0LjcgNS44NyAzLjMgNC42IDMuMyAxNS41IDAgMTUuNy04LjEgMjMuMy01LjIgNC44LTEwLjIgNC44LTEuNCAwLTIuMi0uNXoiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PHBhdGggZD0iTTU1OS43IDg4OC44bDM4IDEzNS41NCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEwIi8+PHBhdGggZD0iTTI0LjcyIDg4Ny42OHYxMzhoMTEuNFY5MDguNzRjNi42IDEyLjcgMTMuNzggMjUuODggMTkuNjYgMzYuNzdsNS43IDEwaC4wMmw1LjcyLTEwYzYuNi0xMiAxMy41NC0yNS4yIDE5Ljc4LTM2Ljd2MTE3aDExLjJWODg3LjdIODdjLTcuMyAxMy4zNi0xNC44IDI3LjM1LTIxLjUgMzkuOGwtNCA3LjQzYy05LjEtMTctMTcuMjgtMzItMjUuNC00Ny4yeiIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSU7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonRXZlciBBZnRlciwgTm9ybWFsJzt0ZXh0LWFsaWduOnN0YXJ0IiBmb250LXNpemU9IjE3Mi41MiIgZm9udC1mYW1pbHk9IkV2ZXIgQWZ0ZXIiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiIGZpbGw9IiM5NTk1OTUiLz48cGF0aCBkPSJNNDIzLjQ4IDEwMjQuNzVjLTMuNzItMS4zMy04Ljk3LTUtMTEuNzctOC4yLTEuMy0xLjYyLTIuNS0zLjI2LTIuNS0zLjYgNC4zLTYuMDUgNC40LTYuMzIgNS4zLTcuNDUgMy4zIDMuNCA2LjcgNi44IDEwLjkgOS4wNyA1IDEuODIgMTEuMyAyLjA4IDE1LjMtLjM0IDUuNS0zLjMgOC42LTguODcgOS43LTE3LjM0IDEuNS0xMS44LTIuNi0yMi42LTEzLjItMzQuOWwtOS4zLTEwLjljLTQuOC01LjctMTAtMTMuNC0xMS44LTE4LjUtNC4zLTEyLjUtMy44LTIxLjMtLjYtMzAuMyAyLjEtNS45IDQuOS05LjYgOS4xLTEyLjIgOC4zLTUuMiAxOS4zLTQuMyAyNy40IDIuMi44LjcgMS43IDEuNCAyLjUgMi41LS40LjctMy44IDguNy00LjQgOC43bC0xLjYtMS4zYy0uNy0uNy0yLjctMi4yLTQuNC0zLjItNC41LTIuMi04LjYtMy4xLTEzLS43LTYuMSAzLjQtOS4yIDExLjctNy45IDIxLjQgMS4xIDguMyA0LjUgMTQgMTcuOSAyOS41IDEzLjEgMTUuMiAxNyAyMi4zIDE4LjkgMzQuNiAxIDUuNiAxIDEwIC4xIDE2LjYtMS43IDEyLjMtNy4yIDIwLjUtMTYuMiAyMy45LTMuMzQgMS4zLTE2LjUgMS4zLTIwLjEgMHoiIGZpbGw9IiM5NTk1OTUiLz48cGF0aCBkPSJNMzE0LjI0IDQ2OS4xN2wxLjI4IDUuOWMxLjY1IDcuNTggNTIuNDggMi45NiAxMTMuNTItMTAuMzIgNjEuMDQtMTMuMjcgMTA5LjItMzAuMTggMTA3LjU1LTM3Ljc2bC0xLjMtNS45eiIgZmlsbD0iIzkyMDIwYiIvPjxwYXRoIGQ9Ik01MzUuMyA0MjEuMWMxLjY1IDcuNTctNDYuNSAyNC40Ny0xMDcuNTQgMzcuNzUtNjEuMDUgMTMuMjctMTExLjg3IDE3LjktMTEzLjUyIDEwLjMyLTEuNjUtNy42IDQ2LjUtMjQuNSAxMDcuNTUtMzcuNzcgNjEtMTMuMjcgMTExLjgtMTcuOSAxMTMuNS0xMC4zIiBmaWxsPSIjY2QwNTE1Ii8+PHBhdGggZD0iTTMwMi44OCAyODQuNzhzNDUuMjIgMTA0LjQgNTguOTIgMTY4LjU1YzEgNC42OCAyOS41MyAyLjQ1IDYzLjY3LTQuOTcgMzQuMTUtNy40MyA2MS0xNy4yNCA2MC0yMS45Mi0xNC4yLTY0LjA0LTE2LjQtMTc3LjgtMTYuNC0xNzcuOGwtMTY2LjIgMzYuMTR6IiBmaWxsPSIjY2QwNTE1Ii8+PHBhdGggZD0iTTQ4NS40NiA0MjYuNDRjLTE0LjE4LTY0LjA0LTE2LjQtMTc3LjgtMTYuNC0xNzcuOGwtNDUuMTUgOS44MmM4LjMgNDAgMjAuOCAxMjguMjQtMTEuMiAxOTIuNSA0LjItLjc4IDguNS0xLjY0IDEyLjktMi42IDM0LjItNy40MyA2MS0xNy4yNCA2MC0yMS45MiIgZmlsbD0iI2FiMDMwZiIvPjxwYXRoIGQ9Ik00MTcuNzQgNDEyLjhjLTI4Ljk1IDYuMy01NC4xNyA5LjE3LTY0LjQ4IDcuNzMgMy40MyAxMS41NiA2LjM3IDIyLjY4IDguNTQgMzIuOCAxLjAyIDQuNjggMjkuNTMgMi40NSA2My42Ny00Ljk3IDM0LjE1LTcuNDMgNjEtMTcuMjQgNjAtMjEuOTItMi4yNC0xMC4xLTQuMTgtMjEuNDUtNS44Ny0zMy40LTguNzcgNS42LTMyLjkgMTMuNDctNjEuODYgMTkuNzciIGZpbGw9IiMwMDI0M2IiLz48cGF0aCBkPSJNNDg0LjUgNDIxLjk3bC0uNTctMi44N2MtLjA1LS4zLS4xLS42LS4xNy0uOWwtLjYyLTMuMjctLjEtLjQ4Yy0uNDgtMi42NC0uOTQtNS4zMy0xLjQtOC4wNy0uMDItLjE4LS4wNi0uMzctLjEtLjU1bC0uNTUtMy41MmMtLjEtLjItLjEtLjUtLjItLjdsLS42LTMuN2MwLS4xLS4xLS4zLS4xLS40bC0uNi00LjItLjEtLjFjLTcuOSA1LTI4IDExLjgtNTIuOSAxNy43LTMuMiAxNC03LjggMjcuNi0xNC4xIDQwLjJsNi4zLTEuMmMyLjEtLjQgNC4zLS45IDYuNS0xLjMgMzQuMS03LjQgNjEtMTcuMiA2MC0yMS45bC0uOC0zLjUtLjItLjkiIGZpbGw9IiMwMDFjMzAiLz48cGF0aCBkPSJNNDY5LjA2IDI0OC42NGMxLjAyIDQuNjgtMzUuMzYgMTYuNTctODEuMjQgMjYuNTUtNDUuOSA5LjktODMuOTIgMTQuMi04NC45NCA5LjUtMS00LjcgMzUuMzYtMTYuNiA4MS4yNS0yNi42IDQ1LjktMTAgODMuOS0xNC4zIDg0LjkzLTkuNiIgZmlsbD0iIzkyMDIwYiIvPjxwYXRoIGQ9Ik0zOTkuMDMgNDIwLjFjLTQgLjg2LTYuNTIgNC44LTUuNjYgOC44bDMuMTYgMTQuNTRjLjg3IDQgNC44MiA2LjUzIDguOCA1LjY2bDM4Ljc2LTguNDJjNC0uODcgNi41LTQuODMgNS42LTguODJsLTMuMi0xNC41NGMtLjktMy45OC00LjgtNi41My04LjgtNS42NnptNDcuMzIgMzAuOTdsLTM4Ljc1IDguNDJjLTkuNzIgMi4xLTE5LjM1LTQuMS0yMS40Ni0xMy44bC0zLjE2LTE0LjZjLTIuMTItOS43IDQuMDctMTkuNCAxMy44LTIxLjVsMzguNzQtOC41YzkuNzMtMi4xIDE5LjM2IDQgMjEuNDcgMTMuOGwzLjEgMTQuNWMyLjEgOS43LTQuMSAxOS4zLTEzLjggMjEuNCIgZmlsbD0iI2ZmOTIwMCIvPjxwYXRoIGQ9Ik0zMTAuODYgMzAzLjhjMi43NCA2LjY2IDYuMDQgMTQuNzggOS42MyAyMy45IDE5LjMtMS40NSA0Ni40LTUuNjIgNzYuMS0xMi4wOCAyOS43LTYuNDYgNTYuMS0xMy45MiA3NC4yLTIwLjYzLS41LTkuOC0uOS0xOC42LTEuMi0yNS44LTE4LjggNy4xLTQ2LjggMTUtNzguNCAyMS45LTMxLjcgNi44LTYwLjQgMTEuMi04MC41IDEyLjZtOTUuMyA1NS40YzI2LjQtNS44IDUwLjEtMTIuMyA2Ny44LTE4LjQtLjctOC43LTEuNC0xNy4zLTEuOS0yNS41LTE4LjUgNi40LTQzLjUgMTMuMy03MS4zIDE5LjMtMjcuOSA2LTUzLjUgMTAuMS03Mi45IDEyIDIuOSA3LjYgNS45IDE1LjcgOC44IDIzLjkgMTguNi0xLjkgNDMtNS44IDY5LjMtMTEuNW05LjUgNDMuNmMyNC4xLTUuMyA0Ni0xMS4yIDYzLjEtMTYuOC0xLjEtOC4zLTIuMS0xNi43LTIuOS0yNS4xLTE3LjcgNS44LTQwLjUgMTEuOS02NS41IDE3LjQtMjUuMSA1LjQtNDguMyA5LjMtNjYuOSAxMS4zIDIuNyA4LjEgNS4zIDE2LjEgNy44IDI0IDE3LjktMiA0MC4zLTUuNyA2NC4zLTEwLjkiIGZpbGw9IiNmZmYiLz48cGF0aCBkPSJNNDc4LjY2IDM4Ni4wM2MtMS4wNy04LjIyLTIuMDMtMTYuNjUtMi44OC0yNS4xLTEyLjMzIDQuMDctMjcuMSA4LjI4LTQzLjQgMTIuMy0uNyA4Ljg0LTEuOCAxNy43Mi0zLjM3IDI2LjUgMTguOC00LjQgMzUuOC05LjE0IDQ5LjctMTMuN20tNC43LTQ1LjE4Yy0uNy04LjctMS4zLTE3LjI3LTEuOC0yNS40Ni0xMSAzLjgtMjQuMyA3LjgtMzkuMiAxMS43LjUgOC4zLjcgMTYuOS41IDI1LjYgMTUuNC00IDI5LjMtOCA0MC42LTExLjlNNDcxIDI5NWMtLjUtOS44LS45LTE4LjYtMS4xNy0yNS44LTExLjAzIDQuMS0yNS4yNSA4LjYtNDEuNSAxMyAxLjE3IDcuNyAyLjI3IDE2IDMuMTUgMjUgMTUuMzQtNC4xIDI4Ljg2LTguMyAzOS41LTEyLjMiIGZpbGw9IiNkNmQ2ZDYiLz48L2c+PC9zdmc+" />
            </a>
            <p>
              Backend Engineer at trivago. Likes just-in-time compilers and hot chocolate. <a href="/about">About me.</a>
            </p>
            <nav>
              <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/talks">Talks</a></li>
                <li><a href="/rss.xml">Feed</a></li>
              </ul>
            </nav>
        </header>
        <main role="main">
            
              <div class="published-date">
                <i>Published on 12th of August 2017</i>
              </div>
            
              <h1>Of Boxes and Trees - Smart Pointers in Rust</h1>
            <p>Recently, I tried to implement a binary tree data structure in Rust.
Each binary tree has a root value, a left, and a right subtree.
I started from this Python implementation, which is quite straightforward.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">class</span><span style="background-color:#eff1f5;color:#343d46;"> </span><span style="background-color:#eff1f5;color:#d08770;">Tree</span><span style="background-color:#eff1f5;color:#343d46;">:</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">def</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#96b5b4;">__init__</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#bf616a;">val</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#bf616a;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#d08770;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#bf616a;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#d08770;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#4f5b66;">val </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> val
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#4f5b66;">left </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> left
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#4f5b66;">right </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> right
</span></pre>
<p>This allows us to declare a fancy tree object like this:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">t </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#bf616a;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">15</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#bf616a;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">12</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">           </span><span style="background-color:#eff1f5;color:#d08770;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">           </span><span style="background-color:#eff1f5;color:#bf616a;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">13</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#bf616a;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">22</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">           </span><span style="background-color:#eff1f5;color:#bf616a;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">18</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">           </span><span style="background-color:#eff1f5;color:#bf616a;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">100</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>And the result can be visualized beautifully.<br />
(Yes I've drawn that myself.)</p>
<div class="loader">
            <object data="/img/posts/2017/boxes-and-trees/tree.svg">A binary search tree representing our data structure"</object>
            <img class="frozen" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAJCAAAAADI5CmLAAAAO0lEQVR42lXHgQaAQBBF0f7/KwOKTVCT3adxgzw7BzgL1f+m8i3jnB6DHIHfAO2++Qf9Yu3+g8T9+tgHi4yFbZQL7eEAAAAASUVORK5CYII" />
        </div>
<p>Porting that code to Rust turned out to be a little... challenging.
My first attempt looked quite innocuous.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">struct</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">i64</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> Tree,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> Tree,
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>That's pretty much a one-to-one translation of the Python definition — but <a target="_blank" href="https://www.youtube.com/watch?v=0n_Ty_72Qds"><strong><code>rustc</code></strong> <strong>says no</strong></a>.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">error</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#d08770;">E0072</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> recursive </span><span style="background-color:#eff1f5;color:#b48ead;">type</span><span style="background-color:#eff1f5;color:#4f5b66;"> `Tree` has infinite size
</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-</span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> src</span><span style="background-color:#eff1f5;color:#4f5b66;">/</span><span style="background-color:#eff1f5;color:#4f5b66;">main.rs</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">|</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">|</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">struct</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">| ^^^^^^^^^^^ recursive type has infinite size
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">|
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">= </span><span style="background-color:#eff1f5;color:#bf616a;">help</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> insert indirection </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">e.g., a `Box`, `Rc`, or `</span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">`</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> at some point to make `Tree` representable
</span></pre>
<p>Coming from memory-managed languages (like Python, PHP, or Ruby), I was confused by this.
The problem is easy to understand, though.
Computers have a limited amount of memory.
It's the compiler's job to find out how much memory to allocate for each item.</p>
<p>In our case, it infers the following:</p>
<p>A tree is a structure containing an <code>i64</code>, and two trees. Each of these trees is a structure containing an <code>i64</code>, and two trees. Each of these...<br />
<a target="_blank" href="https://stackoverflow.com/a/25296420/270334">You get the idea.</a></p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">i64</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">i64</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">...</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">...</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#a7adba;">//</span><span style="background-color:#eff1f5;color:#a7adba;"> The next expansion won&#39;t fit on the page anymore
</span></pre>
<p>Since we don't know how many subtrees our tree will have, there is no way to tell how much memory we need to allocate up front. We'll only know at runtime!</p>
<p>Rust tells us how to fix that: by inserting an <em>indirection</em> like <code>Box</code>, <code>Rc</code>, or <code>&amp;</code>.
These are different &quot;pointer types&quot; in Rust. They all point to places in memory. So, instead of knowing the total size of our tree structure, we just know the <em>point</em> in memory where the tree is located. But that's enough to define the tree structure.
These pointer types allow us to do that safely and without manual memory management.
They all offer different guarantees and you should <a href="/2017/why-type-systems-matter/">choose the one that fits your requirements best</a>.</p>
<ul>
<li>
<p><code>&amp;</code> is called a <code>borrow</code> in Rust speech. It's the most common of the three. It's a reference to some place in memory, but it does not <strong>own</strong> the data it points to. As such, the lifetime of the borrow depends on its owner.
Therefore we would need to add lifetime parameters here. This can make it tedious to use.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">struct</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">i64</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre></li>
<li>
<p><a target="_blank" href="https://doc.rust-lang.org/std/boxed/struct.Box.html"><code>Box</code></a> is a <strong>smart pointer</strong> with zero runtime overhead. It owns the data it points to.
We call it smart because when it goes out of scope it will first drop the data it points to and then itself. No manual memory management required.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">struct</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">i64</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre></li>
<li>
<p><a target="_blank" href="https://doc.rust-lang.org/std/rc/struct.Rc.html"><code>Rc</code></a> is another smart pointer. It's short for &quot;reference-counting&quot;. It keeps track of the number of references to a data structure. As soon as the number of references is down to zero, it cleans up after itself.
Choose <code>Rc</code> if you need to have multiple owners of the same data in one thread.
For multithreading, there's also <a target="_blank" href="https://doc.rust-lang.org/std/sync/struct.Arc.html"><code>Arc</code></a> (atomic reference count).</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">struct</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">i64</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Rc</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Rc</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre></li>
</ul>
<h3>Putting the tree into a box</h3>
<p>All three options are totally valid. Which one you should choose, depends on your use-case.
A rule of thumb is to keep it simple.
In my case, I chose to use a <code>Box</code>, because I did not need any special guarantees.</p>
<h3>Making subtrees optional</h3>
<p>The next problem I faced was, that I could not instantiate a tree structure.
The left and right subtree have the type <code>Box&lt;Tree&gt;</code>, but at some
point I would need an empty subtree.</p>
<p>In the Python example, I used <code>None</code> to signal the end of my data structure.
Thanks to Rust's <a target="_blank" href="https://doc.rust-lang.org/std/option/"><code>Option</code></a> type we can do the same:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">struct</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">i64</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Option</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Option</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>After all of this, we can create our first tree:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">15</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Some</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">12</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Some</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                    </span><span style="background-color:#eff1f5;color:#4f5b66;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">13</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                    </span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                    </span><span style="background-color:#eff1f5;color:#4f5b66;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Some</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">22</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Some</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                    </span><span style="background-color:#eff1f5;color:#4f5b66;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">18</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                    </span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                    </span><span style="background-color:#eff1f5;color:#4f5b66;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Some</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                    </span><span style="background-color:#eff1f5;color:#4f5b66;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">100</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                    </span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">                    </span><span style="background-color:#eff1f5;color:#4f5b66;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">None</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">            </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Depending on your point of view, you might say this is either verbose or explicit.
Compared to the Python version, it looked a bit too cluttered.</p>
<p>Can we do better?
<a target="_blank" href="https://github.com/cjm00">Chris McDonald</a> helped me to come up with the following representation:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">Tree::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">15</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">12</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">13</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">22</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">18</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">100</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>To me, this is much easier on the eye.<br />
Here's the full tree implementation that makes this possible:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#a7adba;">#[derive(Default)]</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">struct</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">i64</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Option</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#bf616a;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Option</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">,
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">impl</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">i64</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> Tree</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Tree </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> root</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">..</span><span style="background-color:#eff1f5;color:#4f5b66;">Default</span><span style="background-color:#eff1f5;color:#4f5b66;">::</span><span style="background-color:#eff1f5;color:#4f5b66;">default</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">, </span><span style="background-color:#eff1f5;color:#bf616a;">leaf</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">Self</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">.left </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Some</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">leaf</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">, </span><span style="background-color:#eff1f5;color:#bf616a;">leaf</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> Tree</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">Self</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">.right </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Some</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">Box</span><span style="background-color:#eff1f5;color:#4f5b66;">::</span><span style="background-color:#eff1f5;color:#4f5b66;">new</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">leaf</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p><strong>Update:</strong> <a target="_blank" href="https://twitter.com/fungos">Danny Grein</a> mentioned on Twitter, that
we can support the following syntax by implementing <a target="_blank" href="https://play.rust-lang.org/?gist=1454d2bfdacf0c83434a3095b0adcb5d&amp;version=stable"><code>From&lt;i64&gt; for Tree</code></a>:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#96b5b4;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">15</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#96b5b4;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">12</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">13</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#96b5b4;">root</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">22</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">18</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">100</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<h3>Why did it work in Python?</h3>
<p>Now you might be wondering, why our tree implementation worked so flawlessly in Python.
The reason is that Python dynamically allocates memory for the tree object at runtime.
Also, it wraps everything inside a <a target="_blank" href="http://pythonextensionpatterns.readthedocs.io/en/latest/refcount.html">PyObject, which is kind of similar to <code>Rc</code> from above</a>
— a reference counted smart pointer.</p>
<p>Rust is more explicit here. It gives us more flexibility to express our needs.
Then again, we need to know about all the possible alternatives to make good use of them.
If you can, then stay away from smart pointers and stick to simple borrows.<br />
If that's not possible, as seen above, choose the least invasive one for your
use-case. The <a target="_blank" href="https://doc.rust-lang.org/book/second-edition/ch15-00-smart-pointers.html">Rust documentation</a> is a good starting point here.
Also, read <a target="_blank" href="https://rust-leipzig.github.io/architecture/2016/12/20/idiomatic-trees-in-rust/">&quot;Idiomatic tree and graph like structures in Rust&quot;</a> for some clever use of allocators.</p>

        </main><footer>
    <ul class="links">
        
        <li class="post-navigation">
            <a href="/2017/why-type-systems-matter"><code>&larr; Previous post</code></a>
            <a href="/"><code>&#8962; Home</code></a>
            <a href="/2017/makefiles"><code>Next post &rarr;</code></a>
        </li>
        <li>❤️ <a target="_blank" href="https://twitter.com/matthiasendler">Follow me on Twitter</a> and never miss a post again.</li>
        <li>🎁 <a target="_blank" href="https://tinyletter.com/mre">Subscribe to new articles.</a></li>
        <li>💬 Comments available on
                <a target="_blank" href="https://www.reddit.com/r/rust/comments/6tkyz3/of_boxes_and_trees_smart_pointers_in_rust/">Reddit</a>.
        </li>
    </ul>
</footer>
<script type="text/javascript">
if (location.hostname !== "localhost" && location.hostname !== "127.0.0.1") {
    window.ga=window.ga||function(){(ga.q = ga.q || []).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-693428-1', 'auto');
    ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>

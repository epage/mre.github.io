<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
    ﻿html,body,div,form,fieldset,legend,label,h1{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0}th,td{text-align:left;vertical-align:top}h1,h2,h3,h4,h5,h6,th,td,caption{font-weight:normal}img{border:0;max-width:100%}video{max-width:100%}h1{font-size:1.87em}h2{font-size:1.2em;margin-bottom:10px;margin-top:0px}h3{margin-top:50px}body{background-color:#fff;color:rgba(0,0,0,0.8);font-family:medium-content-serif-font,Georgia,Cambria,"Times New Roman",Times,serif;-moz-font-feature-settings:"liga" on;font-feature-settings:"liga" on;font-size:1.25em;-moz-osx-font-smoothing:grayscale;font-style:normal;font-weight:400;letter-spacing:-.003em;line-height:1.58;text-rendering:optimizeLegibility}article{margin-top:44px}pre{-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:.92em;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;padding:20px;overflow:auto}::-moz-selection{background:#000;color:#fff}::selection{background:#000;color:#fff}body{margin-top:8%}header{font-size:.78em;margin:0 auto 2em;max-width:220px;text-align:center}a:link,a:visited,a:hover,a:active{color:#AF403C;text-decoration:none}a:hover{text-decoration:underline}nav{text-align:center}nav ul{display:inline-block;text-align:initial;padding-left:0px}nav li:not(:first-child):before{content:" · "}nav li{list-style:none;display:inline}.logo{background-size:cover;display:inline-block;height:150px;width:171px}hr{background-color:#333;border:0;height:1px;margin:30px 0}.published-date{color:#888;font-size:.8em}.subtitle{margin:0 0 2em}blockquote{border-left:4px solid #ededee;font-style:italic;margin:4px 10px;padding:3px 20px}code{background-color:#f9f9fa;border:1px solid #ededee;border-radius:6px;display:inline-block;font-family:"Courier New", "Courier", monospace;-moz-font-feature-settings:"liga" off;font-feature-settings:"liga" off;font-size:16px;-moz-osx-font-smoothing:auto;-webkit-font-smoothing:subpixel-antialiased;max-width:100%;overflow-x:auto;padding:0 5px;vertical-align:middle;word-wrap:normal;box-shadow:0 1px 1px rgba(0,0,0,0.125)}.button{background-color:#AF403C;border-radius:10px;color:#fff;margin:40px auto;padding:10px;text-align:center}.button:hover{background-color:red}.talk{margin-top:80px}figure{font-size:.9em;font-style:italic;margin:0 0 40px;padding:0;text-align:center;text-indent:0}figcaption{margin-top:10px}.loader{position:relative;overflow:hidden;width:auto}.loader object{position:absolute}.loader img,.loader object{display:block;top:0;left:0;width:100%}object{position:relative;float:left;display:block}object::after{position:absolute;top:0;left:0;display:block;width:1000px;height:1000px;content:'';background:#efefef}.frozen{-webkit-filter:blur(8px);-moz-filter:blur(8px);-o-filter:blur(8px);-ms-filter:blur(8px);filter:blur(8px);transform:scale(1.04);animation:0.2s ease-in 0.4s 1 forwards fade;width:100%}@keyframes fade{0%{opacity:1}100%{opacity:0}}@media (max-width: 520px){body{padding:0 20px}pre{font-size:.85em;padding:5px}h1{font-size:1.6em}}@media (min-width: 520px){body{margin:10% auto 0;width:480px}h1{font-size:1.6em}}@media (min-width: 1024px){body{width:850px}header{float:left;width:210px}main,footer{margin-left:260px;margin-bottom:40px}}.post-navigation{margin-bottom:10px}footer{border-top:1px solid black;margin-bottom:40px}footer .links{list-style:none;display:inline}

    </style>
    <link rel="dns-prefetch" href="//www.google-analytics.com/" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=m2llJQPQq8">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=m2llJQPQq8">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=m2llJQPQq8">
    <link rel="manifest" href="/manifest.json?v=m2llJQPQq8">
    <link rel="mask-icon" href="/safari-pinned-tab.svg?v=m2llJQPQq8" color="#5bbad5">
    <link rel="shortcut icon" href="/favicon.ico?v=m2llJQPQq8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">


<meta property="og:title" content="A Little Story About the `yes` Unix Command" />
<meta property="og:type" content="website" />
<meta property="og:description" content="What&#39;s the simplest Unix command you know?&lt;b..." />
<meta property="og:url" content="https://matthias-endler.de/2017/yes" />
<meta property="og:image" content="https://matthias-endler.de/img/social/default.png" />

<meta name="twitter:title" content="A Little Story About the `yes` Unix Command">
<meta name="twitter:description" content="What&#39;s the simplest Unix command you know?&lt;b...">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@matthiasendler">
<meta name="twitter:creator" content="@matthiasendler">
<meta name="twitter:image" content="https://matthias-endler.de/img/social/default.png">

    
    <title>A Little Story About the `yes` Unix Command | Matthias Endler</title>

    <meta name="author" content="Matthias Endler">
    <meta name="description" content="Personal website of Matthias Endler, a Software Engineer interested in low-level programming and backend development. PHP, Python, Go, Rust."/><script type="text/javascript">
if (location.hostname !== "localhost" && location.hostname !== "127.0.0.1") {
    (function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
    0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
    for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);

    mixpanel.init("b90a3ae15c47924a498cf617c96cee0c");
}
</script>

  </head>
  <body>
        <header>
            <a class="logo" href="/"><img alt="Home" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3OTAuMDUgNzc4Ljk1Ij48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjQuNzIyIC0yNDYuNzQ2KSI+PHBhdGggc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSU7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonRXZlciBBZnRlciwgTm9ybWFsJzt0ZXh0LWFsaWduOnN0YXJ0IiBkPSJNNTUzLjEzIDg4Ny40djEzOC4zaDExLjM2Vjg4Ny40em0zOS43NiAwdjUxLjg2bC0uMS0uMTd2MjAuN2wuMS4xdjY1LjdoMTEuMlY4ODcuNHoiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PGNpcmNsZSByPSIyMTkuNjgiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiBjeD0iNDM3Ljg4IiBjeT0iNTYwLjc5IiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjE2LjAzIi8+PGcgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlPSIjYTE2MjAwIj48cGF0aCBkPSJNNTA4LjM4IDU5OC44MmwtNjcuMDcgNDAuMTUtNzQuMi0zOS41M3oiIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiBmaWxsPSIjMzMxZjAwIiBzdHJva2Utd2lkdGg9IjEuOTciLz48cGF0aCBkPSJNNTExLjI4IDU5OWwtNzAuMiAzNC4wMy03Ni45LTMzLjl6IiBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JSIgZmlsbD0iI2VmYmEwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9nPjxnIHN0eWxlPSJsaW5lLWhlaWdodDoxMjUlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxOTMuMjcgMzM2KSBzY2FsZSguNjU3OTUpIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjAiIHdvcmQtc3BhY2luZz0iMCI+PGVsbGlwc2Ugcnk9IjI4IiByeD0iMjUuMjUiIGN5PSItMTYzLjE0IiBjeD0iLTYwOC43NSIgdHJhbnNmb3JtPSJtYXRyaXgoMS4yNDg5NyAtLjExMzcgLjEwNyAxLjE3NTE3IDEwOTUuODcgNDY2LjcpIi8+PGVsbGlwc2Ugcnk9IjE3LjA0IiByeD0iMTUuMTUiIGN5PSIzNDcuOTkiIGN4PSIzMzEuMzYiIHRyYW5zZm9ybT0ibWF0cml4KC41MjIxMyAwIDAgLjU0NzQ1IDE1OC43NTcgMTM2LjQzMikiIGZpbGw9IiNmZmYiLz48L2c+PGcgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE5My4yNyAzMzYpIHNjYWxlKC42NTc5NSkiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIj48ZWxsaXBzZSByeT0iMjgiIHJ4PSIyNS4yNSIgY3k9Ii0xNjMuMTQiIGN4PSItNjA4Ljc1IiB0cmFuc2Zvcm09Im1hdHJpeCgxLjI0ODk3IC0uMTEzNyAuMTA3IDEuMTc1MTcgMTIwMy4yIDQ2Ny42NDYpIi8+PGVsbGlwc2Ugcnk9IjE3LjA0IiByeD0iMTUuMTUiIGN5PSIzNDcuOTkiIGN4PSIzMzEuMzYiIHRyYW5zZm9ybT0ibWF0cml4KC41MjIxMyAwIDAgLjU0NzQ1IDI2NS4zNTggMTM2Ljk5MykiIGZpbGw9IiNmZmYiLz48L2c+PHBhdGggc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSUiIGQ9Ik00MzMuODcgNDIwLjE0Yy04MS44NS4yNy0xNTYuNDQgMTA0LjQzLTE4MC40OCAyMTYuNDVhMTk5LjYgMTk5LjYgMCAwIDAgNTEuOCA3M2M3LjktMTU3LjkgNDQuOC0yNjcgMTEyLjYtMjA3LjkgMTAuMSA4LjggMTUuMSAxMi45IDIwIDEyLjYgNC45LjMgMTAtMy44IDIwLjEtMTIuNyA2Ny43LTU5LjEgMTA0LjYgNDkuOSAxMTIuNSAyMDcuOGExOTkuNiAxOTkuNiAwIDAgMCA1MS44LTcyLjljLTI0LTExMi05OC42LTIxNi4yLTE4MC41LTIxNi41LTEuNCAwLTIuNyAwLTQgLjEtMS40LS4xLTIuNy0uMS00LS4xeiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiLz48cGF0aCBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JTstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOidFdmVyIEFmdGVyLCBOb3JtYWwnO3RleHQtYWxpZ246c3RhcnQiIGQ9Ik0xNTUuOTIgMTAyNS43aDExLjRsLTIwLjktMTM4LjNoLTEyLjI4bC0yMC45IDEzOC4zaDExLjRsNS44Ny00NS44MmgxOS40em0tMjQuMi01NC45OGw4LjQ3LTY0LjMgOC40IDY0LjN6bTgyLjA2LTgzLjMyaC00MS4xNHYxMC43MmgxNC44NnYxMjcuNTdoMTEuNFY4OTguMWgxNC44OHoiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIiBmaWxsPSIjOTU5NTk1Ii8+PHBhdGggc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSU7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonRXZlciBBZnRlciwgTm9ybWFsJzt0ZXh0LWFsaWduOnN0YXJ0IiBkPSJNMjUzLjI4IDg4Ny40aC00MS4xNHYxMC43MkgyMjd2MTI3LjU3aDExLjQyVjg5OC4xaDE0Ljg2em00NC45IDB2NjEuMzdIMjY5LjhWODg3LjRoLTExLjR2MTM4LjNoMTEuNHYtNjYuNGgyOC4zNXY2Ni40aDExLjIzVjg4Ny40ek0zMzYgMTAyNS43aC0xMS40MlY4ODcuNGgxMS40em01Ny42MiAwaDExLjRsLTIwLjktMTM4LjNoLTEyLjI4bC0yMC45MiAxMzguM2gxMS40bDUuOS00NS44MmgxOS4zNXptLTI0LjItNTQuOThsOC40Ny02NC4zIDguNCA2NC4zeiIgZm9udC1mYW1pbHk9IkV2ZXIgQWZ0ZXIiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiIGZpbGw9IiM5NTk1OTUiLz48cGF0aCBzdHlsZT0ibGluZS1oZWlnaHQ6MTI1JTstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOidFdmVyIEFmdGVyLCBOb3JtYWwnO3RleHQtYWxpZ246c3RhcnQiIGQ9Ik01NDEuOSA4OTguMTJWODg3LjRoLTMxLjY0djEzOC4zaDMxLjYzdi0xMC43MmgtMjAuM1Y5NTkuM2gxOC44di0xMC41M2gtMTguOHYtNTAuNjV6bTkxLjI0LTEwLjcySDYxOS4zdjEzOC4zaDEzLjg0cTIyLjMgMCAyOS41Ni0yMi40OCA0LjE1LTEzLjMgNC4xNS00Ni42NyAwLTMzLjM3LTQuMTUtNDYuNjgtNy4yNi0yMi40Ny0yOS41Ni0yMi40N3ptLTEuMiAxMjcuNThoLTEuMjJWODk4LjEyaDEuMnExNS43NCAwIDIwLjU4IDE4LjUgMy4xIDExLjA2IDMuMSAzOS45MyAwIDI4Ljg3LTMuMSAzOS45My00Ljg0IDE4LjUtMjAuNTcgMTguNXptNjAuMjMgMFY4ODcuNGgtMTEuNHYxMzguM2gzMS42MnYtMTAuNzJ6bTYyLjEtMTE2Ljg2Vjg4Ny40aC0zMS42NHYxMzguM2gzMS42M3YtMTAuNzJoLTIwLjIyVjk1OS4zaDE4Ljg0di0xMC41M2gtMTguODR2LTUwLjY1em02MC41IDEyNy41OHEtMTQuMTctMzctMjAuNzQtNzIuMjcgMTQuMTctMTAuMzcgMTQuMTctMzMuODggMC0zMi4xNS0yNy40OC0zMi4xNWgtMTUuMnYxMzguM2gxMS40di02NXEyLjI0LS41MiA2LjktMi4wOCA3LjEgMzMuMzYgMTguMzMgNjcuMDd6bS0zNy44Ni03OC41di00OS4wOGgyLjZxMTAuNiAwIDE0LjcgNS44NyAzLjMgNC42IDMuMyAxNS41IDAgMTUuNy04LjEgMjMuMy01LjIgNC44LTEwLjIgNC44LTEuNCAwLTIuMi0uNXoiIGZvbnQtZmFtaWx5PSJFdmVyIEFmdGVyIiBsZXR0ZXItc3BhY2luZz0iMCIgd29yZC1zcGFjaW5nPSIwIi8+PHBhdGggZD0iTTU1OS43IDg4OC44bDM4IDEzNS41NCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEwIi8+PHBhdGggZD0iTTI0LjcyIDg4Ny42OHYxMzhoMTEuNFY5MDguNzRjNi42IDEyLjcgMTMuNzggMjUuODggMTkuNjYgMzYuNzdsNS43IDEwaC4wMmw1LjcyLTEwYzYuNi0xMiAxMy41NC0yNS4yIDE5Ljc4LTM2Ljd2MTE3aDExLjJWODg3LjdIODdjLTcuMyAxMy4zNi0xNC44IDI3LjM1LTIxLjUgMzkuOGwtNCA3LjQzYy05LjEtMTctMTcuMjgtMzItMjUuNC00Ny4yeiIgc3R5bGU9ImxpbmUtaGVpZ2h0OjEyNSU7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonRXZlciBBZnRlciwgTm9ybWFsJzt0ZXh0LWFsaWduOnN0YXJ0IiBmb250LXNpemU9IjE3Mi41MiIgZm9udC1mYW1pbHk9IkV2ZXIgQWZ0ZXIiIGxldHRlci1zcGFjaW5nPSIwIiB3b3JkLXNwYWNpbmc9IjAiIGZpbGw9IiM5NTk1OTUiLz48cGF0aCBkPSJNNDIzLjQ4IDEwMjQuNzVjLTMuNzItMS4zMy04Ljk3LTUtMTEuNzctOC4yLTEuMy0xLjYyLTIuNS0zLjI2LTIuNS0zLjYgNC4zLTYuMDUgNC40LTYuMzIgNS4zLTcuNDUgMy4zIDMuNCA2LjcgNi44IDEwLjkgOS4wNyA1IDEuODIgMTEuMyAyLjA4IDE1LjMtLjM0IDUuNS0zLjMgOC42LTguODcgOS43LTE3LjM0IDEuNS0xMS44LTIuNi0yMi42LTEzLjItMzQuOWwtOS4zLTEwLjljLTQuOC01LjctMTAtMTMuNC0xMS44LTE4LjUtNC4zLTEyLjUtMy44LTIxLjMtLjYtMzAuMyAyLjEtNS45IDQuOS05LjYgOS4xLTEyLjIgOC4zLTUuMiAxOS4zLTQuMyAyNy40IDIuMi44LjcgMS43IDEuNCAyLjUgMi41LS40LjctMy44IDguNy00LjQgOC43bC0xLjYtMS4zYy0uNy0uNy0yLjctMi4yLTQuNC0zLjItNC41LTIuMi04LjYtMy4xLTEzLS43LTYuMSAzLjQtOS4yIDExLjctNy45IDIxLjQgMS4xIDguMyA0LjUgMTQgMTcuOSAyOS41IDEzLjEgMTUuMiAxNyAyMi4zIDE4LjkgMzQuNiAxIDUuNiAxIDEwIC4xIDE2LjYtMS43IDEyLjMtNy4yIDIwLjUtMTYuMiAyMy45LTMuMzQgMS4zLTE2LjUgMS4zLTIwLjEgMHoiIGZpbGw9IiM5NTk1OTUiLz48cGF0aCBkPSJNMzE0LjI0IDQ2OS4xN2wxLjI4IDUuOWMxLjY1IDcuNTggNTIuNDggMi45NiAxMTMuNTItMTAuMzIgNjEuMDQtMTMuMjcgMTA5LjItMzAuMTggMTA3LjU1LTM3Ljc2bC0xLjMtNS45eiIgZmlsbD0iIzkyMDIwYiIvPjxwYXRoIGQ9Ik01MzUuMyA0MjEuMWMxLjY1IDcuNTctNDYuNSAyNC40Ny0xMDcuNTQgMzcuNzUtNjEuMDUgMTMuMjctMTExLjg3IDE3LjktMTEzLjUyIDEwLjMyLTEuNjUtNy42IDQ2LjUtMjQuNSAxMDcuNTUtMzcuNzcgNjEtMTMuMjcgMTExLjgtMTcuOSAxMTMuNS0xMC4zIiBmaWxsPSIjY2QwNTE1Ii8+PHBhdGggZD0iTTMwMi44OCAyODQuNzhzNDUuMjIgMTA0LjQgNTguOTIgMTY4LjU1YzEgNC42OCAyOS41MyAyLjQ1IDYzLjY3LTQuOTcgMzQuMTUtNy40MyA2MS0xNy4yNCA2MC0yMS45Mi0xNC4yLTY0LjA0LTE2LjQtMTc3LjgtMTYuNC0xNzcuOGwtMTY2LjIgMzYuMTR6IiBmaWxsPSIjY2QwNTE1Ii8+PHBhdGggZD0iTTQ4NS40NiA0MjYuNDRjLTE0LjE4LTY0LjA0LTE2LjQtMTc3LjgtMTYuNC0xNzcuOGwtNDUuMTUgOS44MmM4LjMgNDAgMjAuOCAxMjguMjQtMTEuMiAxOTIuNSA0LjItLjc4IDguNS0xLjY0IDEyLjktMi42IDM0LjItNy40MyA2MS0xNy4yNCA2MC0yMS45MiIgZmlsbD0iI2FiMDMwZiIvPjxwYXRoIGQ9Ik00MTcuNzQgNDEyLjhjLTI4Ljk1IDYuMy01NC4xNyA5LjE3LTY0LjQ4IDcuNzMgMy40MyAxMS41NiA2LjM3IDIyLjY4IDguNTQgMzIuOCAxLjAyIDQuNjggMjkuNTMgMi40NSA2My42Ny00Ljk3IDM0LjE1LTcuNDMgNjEtMTcuMjQgNjAtMjEuOTItMi4yNC0xMC4xLTQuMTgtMjEuNDUtNS44Ny0zMy40LTguNzcgNS42LTMyLjkgMTMuNDctNjEuODYgMTkuNzciIGZpbGw9IiMwMDI0M2IiLz48cGF0aCBkPSJNNDg0LjUgNDIxLjk3bC0uNTctMi44N2MtLjA1LS4zLS4xLS42LS4xNy0uOWwtLjYyLTMuMjctLjEtLjQ4Yy0uNDgtMi42NC0uOTQtNS4zMy0xLjQtOC4wNy0uMDItLjE4LS4wNi0uMzctLjEtLjU1bC0uNTUtMy41MmMtLjEtLjItLjEtLjUtLjItLjdsLS42LTMuN2MwLS4xLS4xLS4zLS4xLS40bC0uNi00LjItLjEtLjFjLTcuOSA1LTI4IDExLjgtNTIuOSAxNy43LTMuMiAxNC03LjggMjcuNi0xNC4xIDQwLjJsNi4zLTEuMmMyLjEtLjQgNC4zLS45IDYuNS0xLjMgMzQuMS03LjQgNjEtMTcuMiA2MC0yMS45bC0uOC0zLjUtLjItLjkiIGZpbGw9IiMwMDFjMzAiLz48cGF0aCBkPSJNNDY5LjA2IDI0OC42NGMxLjAyIDQuNjgtMzUuMzYgMTYuNTctODEuMjQgMjYuNTUtNDUuOSA5LjktODMuOTIgMTQuMi04NC45NCA5LjUtMS00LjcgMzUuMzYtMTYuNiA4MS4yNS0yNi42IDQ1LjktMTAgODMuOS0xNC4zIDg0LjkzLTkuNiIgZmlsbD0iIzkyMDIwYiIvPjxwYXRoIGQ9Ik0zOTkuMDMgNDIwLjFjLTQgLjg2LTYuNTIgNC44LTUuNjYgOC44bDMuMTYgMTQuNTRjLjg3IDQgNC44MiA2LjUzIDguOCA1LjY2bDM4Ljc2LTguNDJjNC0uODcgNi41LTQuODMgNS42LTguODJsLTMuMi0xNC41NGMtLjktMy45OC00LjgtNi41My04LjgtNS42NnptNDcuMzIgMzAuOTdsLTM4Ljc1IDguNDJjLTkuNzIgMi4xLTE5LjM1LTQuMS0yMS40Ni0xMy44bC0zLjE2LTE0LjZjLTIuMTItOS43IDQuMDctMTkuNCAxMy44LTIxLjVsMzguNzQtOC41YzkuNzMtMi4xIDE5LjM2IDQgMjEuNDcgMTMuOGwzLjEgMTQuNWMyLjEgOS43LTQuMSAxOS4zLTEzLjggMjEuNCIgZmlsbD0iI2ZmOTIwMCIvPjxwYXRoIGQ9Ik0zMTAuODYgMzAzLjhjMi43NCA2LjY2IDYuMDQgMTQuNzggOS42MyAyMy45IDE5LjMtMS40NSA0Ni40LTUuNjIgNzYuMS0xMi4wOCAyOS43LTYuNDYgNTYuMS0xMy45MiA3NC4yLTIwLjYzLS41LTkuOC0uOS0xOC42LTEuMi0yNS44LTE4LjggNy4xLTQ2LjggMTUtNzguNCAyMS45LTMxLjcgNi44LTYwLjQgMTEuMi04MC41IDEyLjZtOTUuMyA1NS40YzI2LjQtNS44IDUwLjEtMTIuMyA2Ny44LTE4LjQtLjctOC43LTEuNC0xNy4zLTEuOS0yNS41LTE4LjUgNi40LTQzLjUgMTMuMy03MS4zIDE5LjMtMjcuOSA2LTUzLjUgMTAuMS03Mi45IDEyIDIuOSA3LjYgNS45IDE1LjcgOC44IDIzLjkgMTguNi0xLjkgNDMtNS44IDY5LjMtMTEuNW05LjUgNDMuNmMyNC4xLTUuMyA0Ni0xMS4yIDYzLjEtMTYuOC0xLjEtOC4zLTIuMS0xNi43LTIuOS0yNS4xLTE3LjcgNS44LTQwLjUgMTEuOS02NS41IDE3LjQtMjUuMSA1LjQtNDguMyA5LjMtNjYuOSAxMS4zIDIuNyA4LjEgNS4zIDE2LjEgNy44IDI0IDE3LjktMiA0MC4zLTUuNyA2NC4zLTEwLjkiIGZpbGw9IiNmZmYiLz48cGF0aCBkPSJNNDc4LjY2IDM4Ni4wM2MtMS4wNy04LjIyLTIuMDMtMTYuNjUtMi44OC0yNS4xLTEyLjMzIDQuMDctMjcuMSA4LjI4LTQzLjQgMTIuMy0uNyA4Ljg0LTEuOCAxNy43Mi0zLjM3IDI2LjUgMTguOC00LjQgMzUuOC05LjE0IDQ5LjctMTMuN20tNC43LTQ1LjE4Yy0uNy04LjctMS4zLTE3LjI3LTEuOC0yNS40Ni0xMSAzLjgtMjQuMyA3LjgtMzkuMiAxMS43LjUgOC4zLjcgMTYuOS41IDI1LjYgMTUuNC00IDI5LjMtOCA0MC42LTExLjlNNDcxIDI5NWMtLjUtOS44LS45LTE4LjYtMS4xNy0yNS44LTExLjAzIDQuMS0yNS4yNSA4LjYtNDEuNSAxMyAxLjE3IDcuNyAyLjI3IDE2IDMuMTUgMjUgMTUuMzQtNC4xIDI4Ljg2LTguMyAzOS41LTEyLjMiIGZpbGw9IiNkNmQ2ZDYiLz48L2c+PC9zdmc+" />
            </a>
            <p>
              Backend Engineer at trivago. Likes just-in-time compilers and hot chocolate. <a href="/about">About me.</a>
            </p>
            <nav>
              <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/talks">Talks</a></li>
                <li><a href="/rss.xml">Feed</a></li>
              </ul>
            </nav>
        </header>
        <main role="main">
            
              <div class="published-date">
                <i>Published on 10th of October 2017</i>
              </div>
            
              <h1>A Little Story About the `yes` Unix Command</h1>
            <p>What's the simplest Unix command you know?<br />
There's <code>echo</code>, which prints a string to stdout and <code>true</code>, which always terminates with an exit code of 0.</p>
<p>Among the rows of simple Unix commands, there's also <code>yes</code>.
If you run it without arguments, you get an infinite stream of y's, separated by a newline:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">y
</span><span style="background-color:#eff1f5;color:#4f5b66;">y
</span><span style="background-color:#eff1f5;color:#4f5b66;">y
</span><span style="background-color:#eff1f5;color:#4f5b66;">y
</span><span style="background-color:#eff1f5;color:#4f5b66;">(...you get the idea)
</span></pre>
<p>What seems to be pointless in the beginning turns out to be pretty helpful  :</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">yes | sh boring_installation.sh
</span></pre>
<p>Ever installed a program, which required you to type &quot;y&quot; and hit enter to keep going?
<code>yes</code> to the rescue! It will carefully fulfill this duty, so you can keep watching <a target="_blank" href="https://www.youtube.com/watch?v=yhBExhldRXQ">Pootie Tang</a>.</p>
<h3>Writing yes</h3>
<p>Here's a basic version in... uhm... BASIC.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">10 PRINT &quot;y&quot;
</span><span style="background-color:#eff1f5;color:#4f5b66;">20 GOTO 10
</span></pre>
<p>And here's the same thing in Python:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">while</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">True</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#96b5b4;">print</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Simple, eh? Not so quick!<br />
Turns out, that program is quite slow.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">python yes.py | pv -r &gt; /dev/null
</span><span style="background-color:#eff1f5;color:#4f5b66;">[4.17MiB/s]
</span></pre>
<p>Compare that with the built-in version on my Mac:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">yes | pv -r &gt; /dev/null
</span><span style="background-color:#eff1f5;color:#4f5b66;">[34.2MiB/s]
</span></pre>
<p>So I tried to write a quicker version in Rust. Here's my first attempt:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">env</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> expletive </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">env::</span><span style="background-color:#eff1f5;color:#4f5b66;">args</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">nth</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">unwrap_or</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">into</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">loop</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">println!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> expletive</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Some explanations:</p>
<ul>
<li>The string we want to print in a loop is the first command line parameter and is named <em>expletive</em>. I learned this word from the <code>yes</code> manpage.</li>
<li>I use <code>unwrap_or</code> to get the <em>expletive</em> from the parameters. In case the parameter is not set, we use &quot;y&quot; as a default.</li>
<li>The default parameter gets converted from a string slice (<code>&amp;str</code>) into an <em>owned</em> string on the heap (<code>String</code>) using <code>into()</code>.</li>
</ul>
<p>Let's test it.</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;">cargo run --release | pv -r &gt; /dev/null
</span><span style="background-color:#eff1f5;color:#4f5b66;">   </span><span style="background-color:#eff1f5;color:#4f5b66;">Compiling yes v0.1.0
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Finished release [optimized] target(s) in 1.0 secs
</span><span style="background-color:#eff1f5;color:#4f5b66;">     </span><span style="background-color:#eff1f5;color:#4f5b66;">Running `target/release/yes`
</span><span style="background-color:#eff1f5;color:#4f5b66;">[2.35MiB/s] 
</span></pre>
<p>Whoops, that doesn't look any better. It's even slower than the Python version!
That caught my attention, so I looked around for the source code of a C implementation.</p>
<p>Here's the <a target="_blank" href="https://github.com/dspinellis/unix-history-repo/blob/4c37048d6dd7b8f65481c8c86ef8cede2e782bb3/usr/src/cmd/yes.c">very first version of the program</a>, released with Version 7 Unix and famously authored by Ken Thompson on <nobr>Jan 10, 1979</nobr>:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#bf616a;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">argc</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> argv</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">char</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">*</span><span style="background-color:#eff1f5;color:#4f5b66;">*</span><span style="background-color:#eff1f5;color:#4f5b66;">argv</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">for</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#96b5b4;">printf</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">%s</span><span style="background-color:#eff1f5;color:#96b5b4;">\n</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> argc</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">?</span><span style="background-color:#eff1f5;color:#4f5b66;"> argv</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>No magic here.</p>
<p>Compare that to the <a target="_blank" href="https://github.com/coreutils/coreutils/blame/master/src/yes.c">128-line-version from the GNU coreutils, which is mirrored on Github</a>. After 25 years, <em>it is still under active development!</em>
The last code change happened around a <a target="_blank" href="https://github.com/coreutils/coreutils/commit/4cdb1703aff044de44d27e0558714542197f6dad">year ago</a>.
That's quite fast:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#4f5b66;"># brew install coreutils
</span><span style="background-color:#eff1f5;color:#4f5b66;">gyes | pv -r &gt; /dev/null 
</span><span style="background-color:#eff1f5;color:#4f5b66;">[854MiB/s]
</span></pre>
<p>The important part is at the end:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#a7adba;">/*</span><span style="background-color:#eff1f5;color:#a7adba;"> Repeatedly output the buffer until there is a write error; then fail.  </span><span style="background-color:#eff1f5;color:#a7adba;">*/</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">while</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">full_write</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">STDOUT_FILENO</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> buf</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> bufused</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">==</span><span style="background-color:#eff1f5;color:#4f5b66;"> bufused</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">continue</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Aha! So they simply use a buffer to make write operations faster.
The buffer size is defined by a constant named <code>BUFSIZ</code>, which gets chosen on each system so as to make I/O efficient (see <a target="_blank" href="https://www.gnu.org/software/libc/manual/html_node/Controlling-Buffering.html">here</a>).
On my system, that was defined as 1024 bytes. I actually had better performance with 8192 bytes.</p>
<p>I've extended my Rust program:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">env</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">io::</span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> BufWriter</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> Write</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">const</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">BUFSIZE</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">usize</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">8192</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> expletive </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">env::</span><span style="background-color:#eff1f5;color:#4f5b66;">args</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">nth</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">unwrap_or</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">into</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> writer </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">BufWriter::</span><span style="background-color:#eff1f5;color:#4f5b66;">with_capacity</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">BUFSIZE</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">io::</span><span style="background-color:#eff1f5;color:#4f5b66;">stdout</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">loop</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">        </span><span style="background-color:#eff1f5;color:#4f5b66;">writeln!</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">writer,</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#d08770;">{}</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> expletive</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">unwrap</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>The important part is, that the buffer size is a multiple of four, to ensure <a target="_blank" href="https://stackoverflow.com/a/381368/270334">memory alignment</a>.</p>
<p>Running that gave me 51.3MiB/s.
Faster than the version, which comes with my system, but still way slower than the results from <a target="_blank" href="https://www.reddit.com/r/unix/comments/6gxduc/how_is_gnu_yes_so_fast/">this Reddit post</a> that I found, where the author talks about 10.2GiB/s.</p>
<h3>Update</h3>
<p>Once again, the Rust community did not disappoint.<br />
As soon as this post <a target="_blank" href="https://www.reddit.com/r/rust/comments/75fll1/a_little_story_about_the_yes_unix_command/">hit the Rust subreddit</a>, user <a target="_blank" href="https://www.reddit.com/user/nwydo">nwydo</a> pointed out a <a target="_blank" href="https://www.reddit.com/r/rust/comments/4wde08/optimising_yes_any_further_ideas/">previous discussion</a> on the same topic.
Here's their optimized code, that breaks the 3GB/s mark on my machine:</p>
<pre style="background-color:#eff1f5">
<span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">env</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">io::</span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#bf616a;">self</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> Write</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">process</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">borrow::</span><span style="background-color:#eff1f5;color:#4f5b66;">Cow</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">ffi::</span><span style="background-color:#eff1f5;color:#4f5b66;">OsString</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">pub</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">const</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">BUFFER_CAPACITY</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">usize</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">64</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">*</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">1024</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">pub</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">to_bytes</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">os_str</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> OsString</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">Vec</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">use</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">std::</span><span style="background-color:#eff1f5;color:#4f5b66;">os::</span><span style="background-color:#eff1f5;color:#4f5b66;">unix::</span><span style="background-color:#eff1f5;color:#4f5b66;">ffi::</span><span style="background-color:#eff1f5;color:#4f5b66;">OsStringExt</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">os_str.</span><span style="background-color:#eff1f5;color:#96b5b4;">into_vec</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">fill_up_buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> [</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">], </span><span style="background-color:#eff1f5;color:#bf616a;">output</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;"> [</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">-&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">&#39;a</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">if</span><span style="background-color:#eff1f5;color:#4f5b66;"> output.</span><span style="background-color:#eff1f5;color:#96b5b4;">len</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&gt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer.</span><span style="background-color:#eff1f5;color:#96b5b4;">len</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">/</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">2</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">return</span><span style="background-color:#eff1f5;color:#4f5b66;"> output</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer_size </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> output.</span><span style="background-color:#eff1f5;color:#96b5b4;">len</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#4f5b66;">..</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">clone_from_slice</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">output</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">while</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer_size </span><span style="background-color:#eff1f5;color:#4f5b66;">&lt;</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer.</span><span style="background-color:#eff1f5;color:#96b5b4;">len</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">/</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">2</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> right</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer.</span><span style="background-color:#eff1f5;color:#96b5b4;">split_at_mut</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">right</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#4f5b66;">..</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">clone_from_slice</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">left</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size </span><span style="background-color:#eff1f5;color:#4f5b66;">*</span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">2</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#4f5b66;">..</span><span style="background-color:#eff1f5;color:#4f5b66;">buffer_size</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">write</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#bf616a;">output</span><span style="background-color:#eff1f5;color:#4f5b66;">:</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> stdout </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">io::</span><span style="background-color:#eff1f5;color:#4f5b66;">stdout</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> locked </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> stdout.</span><span style="background-color:#eff1f5;color:#96b5b4;">lock</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#d08770;">0</span><span style="background-color:#eff1f5;color:#b48ead;">u8</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#d08770;">BUFFER_CAPACITY</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">let</span><span style="background-color:#eff1f5;color:#4f5b66;"> filled </span><span style="background-color:#eff1f5;color:#4f5b66;">=</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#96b5b4;">fill_up_buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> buffer</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;"> output</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#b48ead;">while</span><span style="background-color:#eff1f5;color:#4f5b66;"> locked.</span><span style="background-color:#eff1f5;color:#96b5b4;">write_all</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">filled</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">is_ok</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#b48ead;">fn</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#8fa1b3;">main</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#96b5b4;">write</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#4f5b66;">env::</span><span style="background-color:#eff1f5;color:#4f5b66;">args_os</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">nth</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">map</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">to_bytes</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">.</span><span style="background-color:#eff1f5;color:#96b5b4;">map_or</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">Cow::</span><span style="background-color:#eff1f5;color:#4f5b66;">Borrowed</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">&amp;</span><span style="background-color:#eff1f5;color:#b48ead;">b</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#a3be8c;">y</span><span style="background-color:#eff1f5;color:#96b5b4;">\n</span><span style="background-color:#eff1f5;color:#4f5b66;">&quot;</span><span style="background-color:#eff1f5;color:#4f5b66;">[</span><span style="background-color:#eff1f5;color:#4f5b66;">..</span><span style="background-color:#eff1f5;color:#4f5b66;">]</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">|</span><span style="background-color:#eff1f5;color:#b48ead;">mut</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#bf616a;">arg</span><span style="background-color:#eff1f5;color:#4f5b66;">|</span><span style="background-color:#eff1f5;color:#4f5b66;"> </span><span style="background-color:#eff1f5;color:#4f5b66;">{</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">arg.</span><span style="background-color:#eff1f5;color:#96b5b4;">push</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#b48ead;">b</span><span style="background-color:#eff1f5;color:#4f5b66;">&#39;</span><span style="background-color:#eff1f5;color:#96b5b4;">\n</span><span style="background-color:#eff1f5;color:#4f5b66;">&#39;</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">      </span><span style="background-color:#eff1f5;color:#4f5b66;">Cow::</span><span style="background-color:#eff1f5;color:#4f5b66;">Owned</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#4f5b66;">arg</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">    </span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">,</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">  </span><span style="background-color:#eff1f5;color:#4f5b66;">process::</span><span style="background-color:#eff1f5;color:#4f5b66;">exit</span><span style="background-color:#eff1f5;color:#4f5b66;">(</span><span style="background-color:#eff1f5;color:#d08770;">1</span><span style="background-color:#eff1f5;color:#4f5b66;">)</span><span style="background-color:#eff1f5;color:#4f5b66;">;</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span><span style="background-color:#eff1f5;color:#4f5b66;">}</span><span style="background-color:#eff1f5;color:#4f5b66;">
</span></pre>
<p>Now that's a whole different ballgame!</p>
<ul>
<li>We prepare a filled string buffer, which will be reused for each loop.</li>
<li><a target="_blank" href="https://doc.rust-lang.org/std/io/struct.Stdout.html#method.lock">Stdout is protected by a lock</a>. So, instead of constantly acquiring and releasing it, we keep it all the time.</li>
<li>We use a the platform-native <a target="_blank" href="https://doc.rust-lang.org/std/ffi/struct.OsString.html"><code>std::ffi::OsString</code></a> and <a target="_blank" href="https://doc.rust-lang.org/std/borrow/enum.Cow.html"><code>std::borrow::Cow</code></a> to avoid unnecessary allocations.</li>
</ul>
<p>The only thing, that I could contribute was <a target="_blank" href="https://github.com/cgati/yes/pull/3/files">removing an unnecessary <code>mut</code></a>. 😅</p>
<h3>Lessons learned</h3>
<p>The trivial program <code>yes</code> turns out not to be so trivial after all.
It uses output buffering and memory alignment to improve performance.
Re-implementing Unix tools is fun and makes me appreciate the nifty tricks,
which make our computers fast.</p>

        </main><footer>
    <ul class="links">
        
        <li class="post-navigation">
            <a href="/2017/image-previews"><code>&larr; Previous post</code></a>
            <a href="/"><code>&#8962; Home</code></a>
            <a href="/2017/hacktoberfest"><code>Next post &rarr;</code></a>
        </li>
        <li>❤️ <a target="_blank" href="https://twitter.com/matthiasendler">Follow me on Twitter</a> and never miss a post again.</li>
        <li>🎁 <a target="_blank" href="https://tinyletter.com/mre">Subscribe to new articles.</a></li>
        <li>💬 Comments available on
                <a target="_blank" href="https://www.reddit.com/r/rust/comments/75fll1/a_little_story_about_the_yes_unix_command/">Reddit</a>
                and
                <a target="_blank" href="https://news.ycombinator.com/item?id=15454352">Hacker News</a>.
        </li>
        <li>📖 Translated into
                <a target="_blank" href="http://postd.cc/a-little-story-about-the-yes-unix-command/">Japanese</a>.
        </li>
    </ul>
</footer>
<script type="text/javascript">
if (location.hostname !== "localhost" && location.hostname !== "127.0.0.1") {
    window.ga=window.ga||function(){(ga.q = ga.q || []).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-693428-1', 'auto');
    ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
